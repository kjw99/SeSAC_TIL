## LLM

- 생성형 AI
    - 기존에 있는 것을 주는 것이 아니라 계속 새로운 것을 만들어 내는 AI
    - 확률에 기반한 모델
    - 비어있는 문장을 완성해야 한다고 할 때, 내가 입력한 input들 사이 사이에 있는 자기들끼리의 연관성(이걸 Attention 어텐션이라 함)을 각각 다 계산하고 연관성이 높은 것을 선택. 이후 추가적인 단어(토큰)이 오면 또 기존의 토큰과 연관성을 계산해서 확률이 높은 것을 선택하는 방식으로 계산함.
- ai를 활용하는 방법에 대한 깊은 이해가 필요. 적어도 활용할 줄은 알아야 한다. 그래서 적어도 활용은 할 수 있도록 배워보자.
- Reinforcement Learning ( 강화 학습 )
    - 머신러닝이 추구하는 방향?
    - 다양한 길이 존재하고, 목적지가 하나만 있다고 가정할 때 평소엔 짧은 경로로만 가다가 짧은 확률(예시 : 10%)로 “돌아간다”와 같은 다른 행동을 해보는 것.
    - 이를 통해 만약 좋은 결과로 돌아오게 된다면 “이렇게 하면 더 좋은 결과가 나오는구나!” 라고 학습하는 느낌.

## 프롬프트 엔지니어링

프롬프트 엔지니어링은 대규모 언어 모델이 사용자의 의도를 정확히 파악하고 최적의 결과물을 생성하도록 입력을 설계하고 최적화하는 기술이자 과학이다. 

이는 단순한 질문을 넘어, AI에게 문맥, 지침, 예시를 제공하여 원하는 결과물로 유도하는 과정이다.

효과적인 프롬프트를 구성하기 위해서는 모델이 사용자의 의도를 정확히 파악하고 고품질의 결과를 생성할 수 있도록 명확한 구조를 갖추는 것이 중요하다.

### 핵심 구성 요소

- **지시**
모델이 수행해야 할 구체적인 작업이나 명령이다.
"요약하라", "분류하라", "번역하라"와 같이 명확한 동사를 사용하여 모델이 무엇을 해야 하는지 정의하며, 지시는 모호함을 피하고 구체적일수록 좋다.
- **문맥**
모델이 더 나은 응답을 생성하도록 유도하는 배경 정보나 외부 상황이다. 
모델이 상황을 추측하게 하지 말고, "이 작업은 초보자를 위한 것이다"라거나 "첨부된 재무 보고서를 바탕으로 분석하라"와 같이 필요한 정보를 충분히 제공해야 한다. 
이는 모델의 응답 범위를 제한하고 관련성을 높이는 데 도움을 준다.
    - 모든 데이터를 넘겨주자! 정확하게 내가 원하는게 뭔지 자세하게 설명하는 것.
- **입력 데이터**
모델이 처리해야 할 실제 내용이다. 요약해야 할 텍스트, 번역할 문장, 답변해야 할 질문 등이 이에 해당한다. 
입력 데이터는 프롬프트 내에서 XML 태그나 특수 기호 등을 사용해 지시 사항과 명확히 구분해 주는 것이 좋다.
    - 이거 번역해줘. 번역할 내용~~ 이런게 아니라.
    - 다음 <text>를 번역해줘 <text> 내용 </text> 이런식으로 입력하는게 더 명확하게 구분해서 전달하는 것.
- **출력 지시자**
응답의 형식이나 유형을 지정하는 요소입니다. "JSON 형식으로 출력해라", "표로 만들어라", "불렛 포인트를 사용해라"와 같이 원하는 결과물의 형태를 명시합니다,.
    - ~~~~~를 알려줘 가 아니라.
    - 다음 형식으로 알려줘. 예시 : markdown 형식, bulletpoint를 포함한 markdown 형식, 또는 특정 예시를 입력해주는 방식

### 성능 향상을 위한 추가 요소

- **역할 및 정체성**
AI에게 "당신은 노련한 데이터 과학자입니다" 또는 "친절한 고객 서비스 상담원입니다"와 같은 페르소나를 부여한다. 
이를 통해 모델의 어조, 관점, 스타일을 조정하고 특정 도메인의 전문적인 답변을 유도할 수 있다. 
시스템 프롬프트(System Prompt)에 이 내용을 포함하는 것이 효과적이다.
    - 당신은 노련한 데이터 과학자입니다. 보다, 당신은 40년 경력의 데이터 과학자 입니다, 구글에 입사한 데이터 과학자 입니다 등 결과가 다 다르다고 함. 가능한 좋게 말하자.
    - 너는 xyz에 대해 어떻게 생각해? 보다는 너는 xyz에 대해 잘 알고 있는 사람이야. xyz에 대해 어떻게 생각해? 이렇게 정체성을 부여해준 후 물어보면 좋다.
    - 근데 엄청 전문적인 내용의 경우 가끔 이상한 소리를 한다고 함.
- **예시**
원하는 입력과 출력의 쌍을 제공하여 모델이 패턴을 학습하게 하는 기법이다. 
예시는 모델에게 지시 사항을 명확히 전달하고, 결과물의 스타일과 형식을 일관되게 유지하는 데 매우 강력한 도구이다. 
다양한 예시를 제공하면 모델이 의도치 않은 패턴을 학습하는 것을 방지할 수 있다.
    - 예시가 있으면 우리가 원하는 형태의 데이터를 얻을 가능성이 높다.
- **제약 사항**
모델이 하지 말아야 할 것(부정적 제약)이나 반드시 지켜야 할 규칙(긍정적 제약)을 설정한다. 
예를 들어 "전문 용어를 쓰지 마라", "500단어 이내로 작성해라", "외부 라이브러리를 사용하지 마라" 등이 있다.
    - 나 안배고파 X, 나 배불러 O
    - 최대한 긍정적인 어투를 쓰자.
- **구조화 태그**
프롬프트의 각 부분(지시, 문맥, 예시 등)을 명확히 구분하기 위해 XML 태그(`<context>`, `<instruction>`)나 마크다운 헤더(`#`)를 사용한다. 이는 모델이 긴 프롬프트를 정확하게 파싱하고 혼동을 줄이는 데 도움을 준다.

## 핵심 프롬프트 기법

### 제로샷 vs 퓨샷 프롬프팅

- 제로샷 프롬프팅
추가적인 예시 없이 모델에게 직접적인 지시나 질문만 제공하는 방식이다.
    - 사용 예: 다음 텍스트를 요약해 줘. 또는 기후 변화에 대한 에세이를 써 줘.
- 퓨샷 및 멀티샷 프롬프팅
모델이 패턴을 학습할 수 있도록 원하는 입력-출력 예시를 하나 이상 제공하는 기법이다. 예제는 모델의 정확성, 일관성, 스타일을 크게 향상시킨다.
    - 원칙:
        - 다양성: 엣지 케이스를 포함하여 다양한 예시를 제공하면 의도치 않은 패턴 학습을 방지할 수 있다.
        - 일관된 형식: 예시 간의 구조와 형식을 통일해야 모델이 혼란을 겪지 않는다.

```
입력: '고양이' 출력: '수염과 털이 있는 작은 포유류'
입력: '개' 출력: '충성도로 유명한 애완견'
입력: '코끼리' -> (모델이 패턴에 맞춰 생성)
```

### 연쇄적 사고

복잡한 추론이 필요한 작업에서 모델에게 단계별로 생각하라고 지시하여 논리적 오류를 줄이는 기법이다.

- 기본 연쇄적 사고
    - 프롬프트에 `단계별로 생각하라`는 문구를 추가한다.
    - 조금 추상적일 수 있으니까 아래처럼.
- 구조화된 연쇄적 사고
    - 모델이 추론 과정과 최종 답변을 분리하도록 유도한다. 
    예를 들어, thinking 태그 안에서 먼저 추론하고 answer 태그에 답을 내놓게 한다.
- 효과
    - 수학 문제, 논리적 분석, 복잡한 문서 작성 시 정확도와 일관성이 향상되며, 모델의 사고 과정을 통해 디버깅이 용이해진다.

```jsx
철수는 사과 5개를 가졌고 영희에게 2개를 준 뒤, 시장에서 3개를 더 샀다. 철수가 가진 사과는 몇 개인가? 
단계별로 차근차근 생각하여 답을 도출하라.
```

### 역할 부여

AI에게 특정 캐릭터나 직업적 역할을 부여하여 응답의 어조, 관점, 스타일을 조정하는 기법이다.

- 방법: 시스템 프롬프트를 활용하여 `당신은 포춘 500 기업의 데이터 과학자이다`와 같이 설정을 부여한다.
- 효과: 역할이 부여되면 모델은 해당 도메인의 전문적인 관점을 채택하여 더 깊이 있는 분석이나 적절한 톤의 답변을 제공한다.

```jsx
당신은 법률 전문가이다. 아래 계약서 조항에서 사용자에게 불리할 수 있는 독소 조항을 찾아 법률적 근거와 함께 설명하라.
```

# 프롬프트 구조화 및 제어

### XML 태그 활용

프롬프트 내의 지시사항, 문맥, 예시를 명확히 구분하기 위해 XML 태그를 사용한다.

모델이 프롬프트의 각 부분을 명확하게 파싱하도록 도와 환각을 줄이고 정확도를 높인다.

```xml
<role>당신은 유능한 비서입니다.</role>
<instructions>아래 문서를 요약하세요.</instructions>
<document>...(텍스트)...</document>
```

- 역할, 원하는 것, 대상 등을 전부 태그로 공들여서 지시하면 더 좋음.

### 응답 미리 채우기

AI의 응답 시작 부분을 사용자가 미리 작성해 두는 기법이다.

- 형식 강제: JSON 출력이 필요할 때 `{` 로 응답을 시작하게 하여 서문을 건너뛰고 바로 JSON을 생성하게 유도한다.
- 캐릭터 유지: 역할 이름과 같이 시작하여 역할극의 일관성을 유지한다.
- 이 기법은 모델의 출력을 강력하게 제어하고 오류를 줄이는 데 효과적이다.

```jsx
사용자 입력: 아래 질문에 대해 JSON 형식으로 답하라. 질문: 오늘 날씨는?
어시스턴트 응답 시작: { "answer":
```

- 질문 : 
AB : 안녕 나는 AB야. DF : 
답변 : 
안녕 나는 DF야
- 이런 느낌.

### 출력 형식 지정

원하는 결과물의 형식을 구체적으로 명시해야 한다.

- 구체성: 표로 만들어라, 글머리 기호를 사용해라, JSON 형식으로 출력해라 와 같이 명확한 지시를 포함한다.
- 부정적 제약보다는 긍정적 지시: 하지 마라 보다 하라 는 지시가 더 효과적이다.

```jsx
분석 결과를 3개의 열로 구성된 마크다운 표로 작성하라. 열 이름은 항목, 수치, 비고로 설정하라.
```

# 고급 전략 및 최적화

### 프롬프트 체이닝

복잡한 작업을 한 번에 처리하려 하지 말고, 여러 개의 하위 작업으로 나누어 순차적으로 처리하는 기법이다.

- 프로세스: 문서 분석 -> 요점 추출 -> 요약 작성 -> 번역 처럼 단계를 나누어 각 단계의 출력을 다음 단계의 입력으로 사용한다.
- 장점: 각 단계에 모델이 온전히 집중할 수 있어 정확도가 높아지고, 오류 발생 시 원인을 파악하기 쉽다.

```jsx
단계 1: 주어진 텍스트에서 주요 주제 5개를 추출하라.
단계 2: 추출된 각 주제를 제목으로 하여 짧은 블로그 포스트 초안을 작성하라.
```

### 긴 컨텍스트 처리

대량의 문서를 처리할 때는 데이터의 위치가 중요하다.

- 팁: 긴 문서나 데이터와 같은 참조 자료를 프롬프트의 상단에 배치하고, 그 뒤에 지시사항과 질문을 배치하면 성능이 향상될 수 있다.
- 명령 하고서 데이터를 집어 넣느냐, 데이터를 집어 넣고 명령 하느냐. 2개는 결과가 많이 다름! 뒤에 명령을 쓰자!
    - 지금은 Transformer(트랜스포머)를 사용하기에 앞부분 망각하는게 적어지긴 함.

### 모델 파라미터 조정

API를 사용할 경우, 파라미터 조정을 통해 결과의 다양성을 제어할 수 있다.

- 온도: 낮을수록 결정론적이고 일관된 답변을 생성하며, 높을수록 창의적이고 다양한 답변을 생성한다.
- Top-P 및 Top-K: 다음 토큰 선택 시 확률 분포를 잘라내는 방식으로 답변의 다양성을 조절한다.

### 자체 교정 및 검토

모델에게 최종 답변을 내놓기 전에 자신의 답을 검토하거나 계획을 세우도록 지시한다.

- 예시: 최종 답변을 하기 전에 사용자의 요구사항을 모두 충족했는지 검토한다. 또는 코드를 작성한 후 테스트 케이스를 실행해 오류를 확인한다.

```jsx
작성한 파이썬 코드가 시간 복잡도 관점에서 효율적인지 검토하라. 만약 더 효율적인 알고리즘이 있다면 코드를 수정하고 수정 이유를 설명하라.
```

- LLM의 출력물을 다시 LLM에 집어넣는 것.

## Hallucination 할루시네이션

- 사실이 아니거나 존재하지 않는 정보를 그럴듯하게 만들어내는 현상.
- 생성형 AI는 정말 데이터를 생성함. 내가 준 데이터를 통해 확률 기반으로 생성하기 때문에 가끔 거짓말하는 것처럼 답변할 때가 있음. 이걸 할루시네이션이라 한다.
- LAG를 사용해서 주어진 자료 내에서만 답변해! 라고 하거나 답변을 그대로 다시 입력해서 이중 체크하도록 해서 방지할 수 있음.

# 실전 팁 요약

- 명확하고 구체적으로: 모호한 표현을 피하고, 정확한 동사와 수치를 사용한다 (예: 짧게 써라 -> 500단어 내외로 써라).
- 맥락 제공: 모델이 추측하지 않도록 필요한 배경 정보, 용어 정의, 참조 문서를 충분히 제공한다.
    - 내가 가지고 있는 모든 정보를 싹 다 제공하는게 좋음!
- 반복과 실험: 처음부터 완벽한 프롬프트는 존재하지 않는다. 결과를 보며 단어를 바꾸거나 정보를 추가 혹은 삭제하며 최적화한다.
    - 계속 반복적으로 질문을 하라.
- 복잡한 작업 분해: 작업이 너무 복잡하면 단계별 지시로 나누거나 프롬프트 체이닝을 고려한다.
    - 너무 큰 작업은 분해해서 한 단계씩 해결하자. 분해해달라고 해도 좋음
- 보안 및 안전: 편향되거나 유해한 콘텐츠 생성을 방지하기 위해 프롬프트 내에서 제약 조건을 명확히 설정한다.

## 프롬프트 엔지니어링 참고 링크

- 읽어두면 좋을 듯!
- https://cloud.google.com/discover/what-is-prompt-engineering?hl=ko
- https://ai.google.dev/gemini-api/docs/prompting-strategies
- https://platform.claude.com/docs/ko/build-with-claude/prompt-engineering/overview
- https://platform.openai.com/docs/guides/prompt-engineering
- https://www.promptingguide.ai/kr
- https://claude.com/resources/use-cases